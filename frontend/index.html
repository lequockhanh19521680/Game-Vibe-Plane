<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>Stellar Drift: Singularity</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/dialog.css" />
    <link rel="stylesheet" href="css/cursor-fix.css" />
  </head>
  <body>
    <canvas id="game-canvas"></canvas>

    <div id="ui-container">
      <!-- In-game UI elements -->
      <!-- Left Panel: Controls & Stats -->
      <div id="left-game-panel">
        <button id="pause-button" class="game-ui-button">
          <span>‚è∏Ô∏è</span>
          <span>Pause</span>
        </button>
        <div id="score-container">
          <div id="score-display">Score: 0</div>
          <div id="highscore-display">High Score: 0</div>
          <div id="survival-display">Time: 0:00</div>
        </div>
      </div>

      <!-- Right Panel: Live Leaderboard -->
      <div id="right-game-panel">
        <div id="live-leaderboard">
          <div class="leaderboard-header">
            <span>üèÜ</span>
            <span>Live Leaderboard</span>
          </div>
          <div id="leaderboard-connection-status" class="connection-status">
            Connecting...
          </div>
          <div id="leaderboard-content">
            <div class="leaderboard-loading">Loading scores...</div>
          </div>
        </div>
      </div>

      <div id="event-text"></div>

      <!-- Main Menu UI with multiple sections -->
      <div id="main-menu-container">
        <div id="menu-title" class="menu-section">
          <h1>Stellar Drift</h1>
          <h2>SINGULARITY</h2>
        </div>

        <div id="menu-content" class="menu-section">
          <div id="main-menu-screen" class="menu-panel active">
            <p class="menu-description">
              Move to score points. Avoid asteroids, black holes & missiles.
              Survive as long as possible!
            </p>
            <!-- Personal Best Stats -->
            <div id="personal-best-stats">
              <div class="stat-item">
                <span class="stat-label">Highest Score:</span>
                <span id="personal-best-score" class="stat-value">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Best Time:</span>
                <span id="personal-best-time" class="stat-value">0:00</span>
              </div>
            </div>
            <div class="username-input-container">
              <input
                type="text"
                id="username-input"
                maxlength="20"
                placeholder="Enter username (optional)"
                autocomplete="off"
              />
            </div>
            <div class="button-container vertical">
              <button id="start-button" class="menu-button primary">
                Start Battle
              </button>
              <button id="leaderboard-button" class="menu-button">
                Leaderboard
              </button>
              <button id="help-button" class="menu-button">How to Play</button>
            </div>
          </div>

          <div id="leaderboard-screen" class="menu-panel">
            <h3>üìä Dashboard</h3>

            <!-- Tab Navigation -->
            <div class="dashboard-tabs">
              <button class="dashboard-tab active" data-tab="personal">
                üë§ Personal
              </button>
              <button class="dashboard-tab" data-tab="global">üåç Global</button>
              <button class="dashboard-tab" data-tab="analytics">
                üíÄ Death Stats
              </button>
            </div>

            <!-- Tab Content -->
            <div class="dashboard-content">
              <!-- Personal Stats Tab -->
              <div id="personal-tab" class="dashboard-tab-content active">
                <div class="stats-grid">
                  <div class="stat-card">
                    <div class="stat-icon">üèÜ</div>
                    <div class="stat-label">High Score</div>
                    <div class="stat-value" id="dash-high-score">0</div>
                  </div>
                  <div class="stat-card">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-label">Best Time</div>
                    <div class="stat-value" id="dash-best-time">0:00</div>
                  </div>
                  <div class="stat-card">
                    <div class="stat-icon">üéÆ</div>
                    <div class="stat-label">Games Played</div>
                    <div class="stat-value" id="dash-games-played">0</div>
                  </div>
                  <div class="stat-card">
                    <div class="stat-icon">üíÄ</div>
                    <div class="stat-label">Total Deaths</div>
                    <div class="stat-value" id="dash-total-deaths">0</div>
                  </div>
                </div>
              </div>

              <!-- Global Leaderboard Tab -->
              <div id="global-tab" class="dashboard-tab-content">
                <div class="leaderboard-filters">
                  <button class="filter-btn active" data-filter="all">
                    üåé All Countries
                  </button>
                  <button class="filter-btn" data-filter="country">
                    üáªüá≥ Your Country
                  </button>
                </div>
                <div id="leaderboard-content">
                  <div id="leaderboard-list">
                    <!-- Leaderboard entries will be added here dynamically -->
                    <p class="leaderboard-empty">
                      No high scores yet. Be the first!
                    </p>
                  </div>
                </div>
              </div>

              <!-- Death Analytics Tab -->
              <div id="analytics-tab" class="dashboard-tab-content">
                <h4 style="color: var(--primary-color); margin-bottom: 1rem">
                  Most Common Deaths
                </h4>
                <div id="death-stats-container">
                  <div class="death-stat-item">
                    <span class="death-icon">‚òÑÔ∏è</span>
                    <span class="death-cause">Asteroid</span>
                    <span class="death-count" id="death-asteroid">0</span>
                  </div>
                  <div class="death-stat-item">
                    <span class="death-icon">üï≥Ô∏è</span>
                    <span class="death-cause">Black Hole</span>
                    <span class="death-count" id="death-blackhole">0</span>
                  </div>
                  <div class="death-stat-item">
                    <span class="death-icon">üöÄ</span>
                    <span class="death-cause">Missile</span>
                    <span class="death-count" id="death-missile">0</span>
                  </div>
                  <div class="death-stat-item">
                    <span class="death-icon">‚ö°</span>
                    <span class="death-cause">Lightning</span>
                    <span class="death-count" id="death-lightning">0</span>
                  </div>
                  <div class="death-stat-item">
                    <span class="death-icon">üî•</span>
                    <span class="death-cause">Other</span>
                    <span class="death-count" id="death-other">0</span>
                  </div>
                </div>
              </div>
            </div>

            <button id="back-from-leaderboard" class="menu-button">
              Back to Menu
            </button>
          </div>

          <div id="help-screen" class="menu-panel">
            <h3>How to Play</h3>
            <div class="help-content">
              <p><strong>Move:</strong> Move your mouse to control your ship</p>
              <p>
                <strong>Score:</strong> Moving around earns points, destroying
                obstacles gives bonus
              </p>
              <p>
                <strong>Survive:</strong> Avoid obstacles and hazards as long as
                possible
              </p>
              <p>
                <strong>Power-ups:</strong> Collect crystals for temporary
                shields
              </p>
            </div>
            <button id="back-from-help" class="menu-button">
              Back to Menu
            </button>
          </div>
        </div>
      </div>

      <!-- Game Over Screen -->
      <div id="game-over-screen" class="ui-element">
        <h2>Game Over</h2>
        <p id="final-score">Your score: 0</p>
        <p id="final-time">Survival time: 0:00</p>
        <p id="new-highscore-msg">New High Score!</p>
        <div class="button-container">
          <button id="restart-button">Try Again</button>
          <button id="main-menu-button">Main Menu</button>
        </div>
      </div>

      <!-- Pause Menu -->
      <div id="pause-menu" class="pause-overlay" style="display: none">
        <div class="pause-content">
          <h2>Game Paused</h2>
          <div class="button-container">
            <button id="resume-button" class="menu-button primary">
              Resume
            </button>
            <button id="pause-main-menu-button" class="menu-button">
              Main Menu
            </button>
          </div>
        </div>
      </div>

      <!-- High Score Dialog REMOVED - Using direct save instead -->
    </div>

    <!-- Load mobile optimizer first (before game config) -->
    <script src="js/utils/mobileOptimizer.js"></script>

    <!-- Load game configuration -->
    <script src="gameConfig.js"></script>

    <!-- Load backend API integration -->
    <script src="js/api/backendApi.js"></script>

    <!-- Load game modules in order -->
    <script src="js/audio/audioSystem.js"></script>
    <script src="js/audio/soundEffects.js"></script>
    <script src="js/audio/musicSystem.js"></script>

    <!-- Load base classes first (SOLID principles) -->
    <script src="js/base/Entity.js"></script>

    <!-- Load entity classes -->
    <script src="js/entities/player.js"></script>
    <script src="js/entities/visuals.js"></script>
    <script src="js/entities/warnings.js"></script>
    <script src="js/entities/obstacles.js"></script>
    <script src="js/entities/collectibles.js"></script>
    <script src="js/entities/hazards.js"></script>
    <script src="js/entities/hazards/plasmaField.js"></script>
    <script src="js/entities/hazards/freezeZone.js"></script>
    <script src="js/entities/hazards/laserTurret.js"></script>
    <script src="js/entities/hazards/lightningStorm.js"></script>
    <script src="js/entities/hazards/magneticStorm.js"></script>
    <script src="js/entities/hazards/superNova.js"></script>
    <script src="js/entities/hazards/gravityWave.js"></script>
    <script src="js/entities/hazards/timeDistortion.js"></script>
    <script src="js/entities/hazards/chainLightning.js"></script>
    <script src="js/entities/hazards/voidRift.js"></script>
    <script src="js/entities/hazards/cosmicMine.js"></script>
    <script src="js/entities/portals.js"></script>

    <!-- Load UI system -->
    <script src="js/ui/common.js"></script>
    <script src="js/ui/menuSystem.js"></script>
    <script src="js/ui/dashboard.js"></script>
    <script src="js/ui/initUI.js"></script>

    <!-- Load game logic -->
    <script src="js/utils/helpers.js"></script>
    <script src="js/core/game.js"></script>
    <script src="js/core/eventSystem.js"></script>

    <!-- Load main game last -->
    <script src="js/main.js"></script>
  </body>
</html>
