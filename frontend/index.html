<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>Stellar Drift: Singularity</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/dialog.css" />
    <link rel="stylesheet" href="css/leaderboard.css" />
    <link rel="stylesheet" href="css/settings.css" />
    <link rel="stylesheet" href="css/playerName.css" />
    <link rel="stylesheet" href="css/gameUI.css" />
  </head>
  <body>
    <!-- Lớp phủ Modal - Được hiển thị bởi settingsUI.js -->
    <!-- <div id="modal-overlay" style="display: none;"></div> -->

    <canvas id="game-canvas"></canvas>

    <div id="ui-container">
      <!-- HUD Bar: Score, Level, Time -->
      <div id="top-bar">
        <!-- Left Section: High Score -->
        <div class="hud-left">
          <div id="highscore-display">High Score: 0</div>
        </div>
        <!-- Center Section: Level, Score, Time -->
        <div class="hud-center">
          <div id="level-display">Level: 1</div>
          <div id="level-progress-bar-container">
            <div id="level-progress-bar"></div>
          </div>
          <div class="hud-stats-container">
            <div id="score-display">Score: 0</div>
            <div id="survival-display">Time: 0:00</div>
          </div>
        </div>
        <!-- Right Section: Pause Button -->
        <div class="hud-right">
          <button id="pause-button" style="display: none">❚❚</button>
        </div>
      </div>

      <div id="event-text"></div>

      <!-- Main Menu Screen (Tối ưu hóa bố cục) -->
      <div id="start-screen" class="ui-element">
        <h1>Stellar Drift</h1>
        <h2>SINGULARITY</h2>
        <p>
          <span data-translate="menu.description"
            >Move to score points. Avoid asteroids, black holes & missiles.
            Survive as long as possible!</span
          >
        </p>

        <div class="name-input-section" id="name-input-wrapper">
          <div class="input-group">
            <input
              type="text"
              id="player-name-input"
              class="name-input"
              placeholder="Your name..."
              data-translate-placeholder="playerName.placeholder"
              maxlength="20"
              autocomplete="off"
            />
          </div>
          <div class="name-requirements">
            Your name will appear on the leaderboard (2-20 chars)
          </div>
        </div>

        <!-- Nhóm các nút lại cho gọn gàng hơn -->
        <div class="menu-buttons-group">
          <button id="start-button" data-translate="menu.startBattle">
            Start Battle
          </button>
          <button id="leaderboard-button" data-translate="menu.leaderboard">
            Leaderboard
          </button>
          <button id="how-to-play-button" data-translate="menu.howToPlay">
            How to Play
          </button>
          <!-- <button id="settings-button" data-translate="menu.settings">
            Settings
          </button> -->
        </div>
      </div>

      <!-- Enhanced Game Over Screen -->
      <div id="game-over-screen" class="ui-element game-over-enhanced">
        <div class="game-over-header">
          <h2 data-translate="gameOver.title">Game Over</h2>
          <div id="death-cause" class="death-cause">Destroyed by asteroid</div>
        </div>

        <div class="game-over-stats">
          <div class="primary-stats">
            <div class="stat-item highlight">
              <div class="stat-label" data-translate="gameOver.yourScore">
                Final Score
              </div>
              <div id="final-score" class="stat-value">0</div>
            </div>
            <div class="stat-item">
              <div class="stat-label" data-translate="gameOver.survivalTime">
                Survival Time
              </div>
              <div id="final-time" class="stat-value">0:00</div>
            </div>
          </div>

          <!-- <div class="secondary-stats">
            <div class="stat-row">
              <span class="stat-name">Level Reached:</span>
              <span id="final-level" class="stat-data">1</span>
            </div>
            <div class="stat-row">
              <span class="stat-name">Enemies Avoided:</span>
              <span id="enemies-avoided" class="stat-data">0</span>
            </div>
            <div class="stat-row">
              <span class="stat-name">Power-ups Collected:</span>
              <span id="powerups-collected" class="stat-data">0</span>
            </div>
            <div class="stat-row">
              <span class="stat-name">Distance Traveled:</span>
              <span id="distance-traveled" class="stat-data">0m</span>
            </div>
          </div> -->

          <div
            class="achievement-section"
            id="achievements-section"
            style="display: none"
          >
            <h4>🏆 Achievements Unlocked</h4>
            <div id="achievements-list" class="achievements-list"></div>
          </div>
        </div>

        <div id="new-highscore-msg" class="new-record-banner">
          <div class="record-icon">👑</div>
          <div class="record-text">
            <div class="record-title" data-translate="gameOver.newHighScore">
              New High Score!
            </div>
            <div class="record-subtitle">You're now in the top ranks!</div>
          </div>
        </div>

        <div class="game-over-actions">
          <button
            id="restart-button"
            class="action-button primary"
            data-translate="gameOver.tryAgain"
          >
            <span class="button-icon">🔄</span>
            <span class="button-text">Try Again</span>
          </button>
          <button
            id="main-menu-from-over-button"
            class="action-button secondary"
            data-translate="gameOver.mainMenu"
          >
            <span class="button-icon">🏠</span>
            <span class="button-text">Main Menu</span>
          </button>
        </div>
      </div>

      <!-- Leaderboard Screen -->
      <div id="leaderboard-screen" class="ui-element" style="display: none">
        <h2>Live Dashboard</h2>
        <div class="dashboard-tabs">
          <button class="dashboard-tab active" data-tab="global-leaderboard">
            🏆 Top Players
          </button>
          <button class="dashboard-tab" data-tab="country-leaderboard">
            🌍 Top Countries
          </button>
          <button class="dashboard-tab" data-tab="my-stats">📊 My Stats</button>
        </div>

        <!-- Global Leaderboard Tab -->
        <div id="global-leaderboard-content" class="dashboard-content active">
          <div class="leaderboard-header">
            <h3>🏆 Global Top 10</h3>
            <div class="live-indicator">
              <span id="connection-indicator">🔴</span>
              <span id="connection-text">Connecting...</span>
            </div>
          </div>
          <div id="global-leaderboard-list" class="leaderboard-container">
            <div class="loading">Loading leaderboard...</div>
          </div>
        </div>

        <!-- Country Leaderboard Tab -->
        <div id="country-leaderboard-content" class="dashboard-content">
          <div class="leaderboard-header">
            <h3>🌍 Top 10 Countries</h3>
            <div class="live-indicator">
              <span class="live-dot"></span>
              <span>LIVE</span>
            </div>
          </div>
          <div class="country-info">
            <p>Countries ranked by top 10% of players' combined score</p>
          </div>
          <div id="country-leaderboard-list" class="leaderboard-container">
            <div class="loading">Loading country rankings...</div>
          </div>
        </div>

        <!-- My Stats Tab -->
        <div id="my-stats-content" class="dashboard-content">
          <h3>📊 Your Statistics</h3>
          <div id="player-stats" class="stats-container">
            <div class="loading">Loading your stats...</div>
          </div>
        </div>

        <div class="leaderboard-footer">
          <div class="connection-status">
            <span id="connection-indicator-footer">🔴</span>
            <span id="connection-text-footer">Connecting...</span>
          </div>
          <button id="back-to-main-menu-button">Back to Menu</button>
        </div>
      </div>

      <!-- How to Play Screen -->
      <div id="how-to-play-screen" class="ui-element" style="display: none">
        <h2>How to Play</h2>
        <p>
          - **Move:** Use your mouse or finger to guide the ship.
          <br />- **Score:** Earn points by moving and surviving. <br />-
          **Avoid:** Dodge asteroids, missiles, black holes, and lasers. <br />-
          **Power-ups:** Collect crystals to gain a temporary shield.
        </p>
        <button id="back-to-main-from-how-to-play-button">Back</button>
      </div>

      <!-- Enhanced Pause Menu -->
      <div
        id="pause-menu"
        class="ui-element pause-enhanced"
        style="display: none"
      >
        <div class="pause-header">
          <h2 data-translate="pause.title">Game Paused</h2>
          <div class="pause-subtitle">Take a break, you're doing great!</div>
        </div>

        <div class="pause-stats">
          <div class="current-session">
            <h4>📊 Current Session</h4>
            <div class="session-grid">
              <div class="session-stat">
                <span class="session-label">Score:</span>
                <span id="pause-current-score" class="session-value">0</span>
              </div>
              <div class="session-stat">
                <span class="session-label">Time:</span>
                <span id="pause-current-time" class="session-value">0:00</span>
              </div>
              <div class="session-stat">
                <span class="session-label">Level:</span>
                <span id="pause-current-level" class="session-value">1</span>
              </div>
              <div class="session-stat">
                <span class="session-label">High Score:</span>
                <span id="pause-high-score" class="session-value">0</span>
              </div>
            </div>
          </div>

          <div class="pause-tips">
            <h4>💡 Pro Tips</h4>
            <div id="pause-tip" class="tip-text">
              Collect crystal shards for temporary shields!
            </div>
          </div>
        </div>

        <div class="pause-actions">
          <button
            id="resume-button"
            class="action-button primary"
            data-translate="pause.resume"
          >
            <span class="button-icon">▶️</span>
            <span class="button-text">Resume Game</span>
          </button>
          <button
            id="restart-from-pause-button"
            class="action-button secondary"
            data-translate="pause.restart"
          >
            <span class="button-icon">🔄</span>
            <span class="button-text">Restart</span>
          </button>
          <button
            id="main-menu-from-pause-button"
            class="action-button secondary"
            data-translate="pause.mainMenu"
          >
            <span class="button-icon">🏠</span>
            <span class="button-text">Main Menu</span>
          </button>
        </div>
      </div>

      <!-- Settings Screen được tạo động bởi settingsUI.js -->
      <!-- Loại bỏ <div id="settings-screen" ...> cũ -->
    </div>

    <audio id="background-music" loop src="assets/audio/background.mp3"></audio>

    <script src="gameConfig.js"></script>
    <script type="module" src="js/config/environment.js"></script>
    <script src="js/config/endpoints.js"></script>
    <script src="js/api/backendApi.js"></script>
    <script src="js/audio/audioSystem.js"></script>
    <script src="js/audio/musicSystem.js"></script>
    <script src="js/audio/soundEffects.js"></script>
    <script src="js/base/Entity.js"></script>
    <script src="js/utils/userIdentification.js"></script>
    <script src="js/utils/helpers.js"></script>
    <script src="js/entities/visuals.js"></script>
    <script src="js/core/entityFactory.js"></script>
    <script src="js/core/gameStateManager.js"></script>
    <script src="js/entities/player.js"></script>
    <script src="js/entities/warnings.js"></script>
    <script src="js/entities/obstacles.js"></script>
    <script src="js/entities/collectibles.js"></script>
    <script src="js/entities/hazards.js"></script>
    <script src="js/entities/portals.js"></script>
    <script src="js/core/game.js"></script>
    <script src="js/core/eventSystem.js"></script>
    <script src="js/config/settings.js"></script>
    <script src="js/ui/settingsUI.js"></script>
    <script src="js/ui/playerNameUI.js"></script>
    <script src="js/ui/gameUI.js"></script>
    <script src="js/main.js"></script>
    <script src="js/ui/dashboard.js"></script>
    <script src="js/ui/initUI.js"></script>
    <script src="js/ui/menuSystem.js"></script>
  </body>
</html>
